<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Storybook Haven - Children's Storybooks</title>
  
  <!-- Flutterwave -->
  <script src="https://checkout.flutterwave.com/v3.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #2563eb;
      --primary-dark: #1e40af;
      --secondary: #60a5fa;
      --bg: #f0f9ff;
      --card: #ffffff;
      --text: #1e293b;
      --text-light: #64748b;
      --border: #e2e8f0;
      --success: #10b981;
      --danger: #ef4444;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
    }

    /* Header */
    header {
      background: var(--primary);
      color: white;
      padding: 1rem 0;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 1.8rem;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .logo-icon {
      font-size: 2rem;
    }

    .cart-btn {
      background: white;
      color: var(--primary);
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.3s;
      position: relative;
    }

    .cart-btn:hover {
      background: var(--bg);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .cart-count {
      background: var(--danger);
      color: white;
      border-radius: 50%;
      padding: 0.2rem 0.5rem;
      font-size: 0.8rem;
      min-width: 20px;
      text-align: center;
    }

    /* Hero Section */
    .hero {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      padding: 3rem 0;
      text-align: center;
    }

    .hero h1 {
      font-size: 2.5rem;
      margin-bottom: 1rem;
    }

    .hero p {
      font-size: 1.2rem;
      opacity: 0.95;
    }

    /* Products Section */
    .products-section {
      padding: 3rem 0;
    }

    .section-title {
      text-align: center;
      font-size: 2rem;
      margin-bottom: 2rem;
      color: var(--primary);
    }

    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 2rem;
      margin-top: 2rem;
    }

    .product-card {
      background: var(--card);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: all 0.3s;
      display: flex;
      flex-direction: column;
    }

    .product-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.15);
    }

    .product-image {
      width: 100%;
      height: 300px;
      object-fit: cover;
      background: var(--bg);
    }

    .product-info {
      padding: 1.5rem;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    .product-title {
      font-size: 1.3rem;
      margin-bottom: 0.5rem;
      color: var(--primary);
      font-weight: 600;
    }

    .product-description {
      color: var(--text-light);
      margin-bottom: 1rem;
      flex-grow: 1;
      font-size: 0.95rem;
    }

    .product-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: auto;
    }

    .product-price {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--primary);
    }

    .add-to-cart-btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }

    .add-to-cart-btn:hover {
      background: var(--primary-dark);
      transform: scale(1.05);
    }

    .add-to-cart-btn:active {
      transform: scale(0.95);
    }

    /* Cart Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.6);
      z-index: 2000;
      overflow-y: auto;
    }

    .modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .modal-content {
      background: white;
      border-radius: 16px;
      max-width: 800px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    .modal-header {
      background: var(--primary);
      color: white;
      padding: 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-radius: 16px 16px 0 0;
    }

    .modal-header h2 {
      font-size: 1.8rem;
    }

    .close-btn {
      background: none;
      border: none;
      color: white;
      font-size: 2rem;
      cursor: pointer;
      line-height: 1;
      transition: transform 0.2s;
    }

    .close-btn:hover {
      transform: scale(1.2);
    }

    .modal-body {
      padding: 2rem;
    }

    .empty-cart {
      text-align: center;
      padding: 3rem 1rem;
      color: var(--text-light);
    }

    .empty-cart-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
    }

    .cart-item {
      display: flex;
      gap: 1rem;
      padding: 1.5rem;
      border: 1px solid var(--border);
      border-radius: 12px;
      margin-bottom: 1rem;
      background: var(--bg);
    }

    .cart-item-image {
      width: 100px;
      height: 120px;
      object-fit: cover;
      border-radius: 8px;
      flex-shrink: 0;
    }

    .cart-item-details {
      flex-grow: 1;
    }

    .cart-item-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 0.5rem;
    }

    .cart-item-price {
      font-size: 1.1rem;
      color: var(--text-light);
      margin-bottom: 1rem;
    }

    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .qty-btn {
      background: var(--primary);
      color: white;
      border: none;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .qty-btn:hover {
      background: var(--primary-dark);
      transform: scale(1.1);
    }

    .qty-display {
      font-size: 1.1rem;
      font-weight: 600;
      min-width: 30px;
      text-align: center;
    }

    .remove-btn {
      background: var(--danger);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.2s;
      margin-left: auto;
    }

    .remove-btn:hover {
      background: #dc2626;
      transform: scale(1.05);
    }

    .cart-summary {
      background: var(--bg);
      padding: 1.5rem;
      border-radius: 12px;
      margin-top: 2rem;
    }

    .cart-total {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--primary);
      margin-bottom: 1.5rem;
    }

    .checkout-btn {
      background: var(--success);
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1.1rem;
      font-weight: 600;
      width: 100%;
      transition: all 0.3s;
    }

    .checkout-btn:hover {
      background: #059669;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    .checkout-btn:disabled {
      background: var(--text-light);
      cursor: not-allowed;
      transform: none;
    }

    /* Footer */
    footer {
      background: var(--primary);
      color: white;
      text-align: center;
      padding: 2rem 0;
      margin-top: 4rem;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .hero h1 {
        font-size: 2rem;
      }

      .hero p {
        font-size: 1rem;
      }

      .products-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }

      .cart-item {
        flex-direction: column;
      }

      .cart-item-image {
        width: 100%;
        height: 200px;
      }

      .quantity-controls {
        justify-content: space-between;
      }

      .remove-btn {
        margin-left: 0;
        margin-top: 1rem;
        width: 100%;
      }

      .modal-content {
        margin: 1rem;
      }
    }

    @media (max-width: 480px) {
      .logo {
        font-size: 1.3rem;
      }

      .cart-btn {
        padding: 0.6rem 1rem;
        font-size: 0.9rem;
      }

      .section-title {
        font-size: 1.5rem;
      }
    }

    /* Loading Spinner */
    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Success Animation */
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .cart-item {
      animation: slideIn 0.3s ease-out;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="container">
      <div class="header-content">
        <div class="logo">
          <span class="logo-icon">ðŸ“š</span>
          <span>Storybook Haven</span>
        </div>
        <button class="cart-btn" onclick="openCart()">
          ðŸ›’ Cart
          <span class="cart-count" id="cartCount">0</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="hero">
    <div class="container">
      <h1>Magical Stories for Young Readers</h1>
      <p>Discover enchanting tales that spark imagination and inspire wonder</p>
    </div>
  </section>

  <!-- Products Section -->
  <section class="products-section">
    <div class="container">
      <h2 class="section-title">Featured Storybooks</h2>
      <div class="products-grid" id="productsGrid">
        <!-- Products will be loaded here by JavaScript -->
      </div>
    </div>
  </section>

  <!-- Cart Modal -->
  <div class="modal" id="cartModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Shopping Cart</h2>
        <button class="close-btn" onclick="closeCart()">&times;</button>
      </div>
      <div class="modal-body">
        <div id="cartItems">
          <!-- Cart items will be loaded here -->
        </div>
        <div id="cartSummary" style="display:none;">
          <div class="cart-summary">
            <div class="cart-total">
              <span>Total:</span>
              <span id="cartTotal">$0.00</span>
            </div>
            <button class="checkout-btn" onclick="checkout()">
              Proceed to Checkout
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <div class="container">
      <p>&copy; 2024 Storybook Haven. All rights reserved.</p>
      <p>Bringing magical stories to children everywhere ðŸŒŸ</p>
    </div>
  </footer>

  <script>
    // Configuration
    const FLUTTERWAVE_PUBLIC_KEY = "FLWPUBK_TEST-5b4150815a6fca2a61114c76bdb07f01-X";
    const API_URL = "YOUR_GOOGLE_APPS_SCRIPT_URL_HERE"; // Replace with your deployed script URL

    // Sample Products
    const products = [
      {
        id: 1,
        title: "The Rainbow Dragon",
        description: "Join Luna on an adventure with a magical rainbow dragon who teaches her about colors, friendship, and believing in yourself.",
        price: 15.99,
        image: "https://images.unsplash.com/photo-1544947950-fa07a98d237f?w=400&h=500&fit=crop"
      },
      {
        id: 2,
        title: "Adventures in Dreamland",
        description: "Explore a world where dreams come true and imagination knows no bounds. Perfect for bedtime reading!",
        price: 12.99,
        image: "https://images.unsplash.com/photo-1481627834876-b7833e8f5570?w=400&h=500&fit=crop"
      },
      {
        id: 3,
        title: "The Little Astronaut",
        description: "Blast off to space with Max, a curious child who dreams of exploring the stars and discovering new planets.",
        price: 18.99,
        image: "https://images.unsplash.com/photo-1512820790803-83ca734da794?w=400&h=500&fit=crop"
      },
      {
        id: 4,
        title: "Forest Friends Forever",
        description: "Meet the adorable animals of Whispering Woods and learn valuable lessons about kindness, sharing, and teamwork.",
        price: 14.99,
        image: "https://images.unsplash.com/photo-1503023345310-bd7c1de61c7d?w=400&h=500&fit=crop"
      },
      {
        id: 5,
        title: "The Magic Paintbrush",
        description: "A young artist discovers a paintbrush that brings her paintings to life, leading to colorful adventures.",
        price: 16.99,
        image: "https://images.unsplash.com/photo-1519682337058-a94d519337bc?w=400&h=500&fit=crop"
      },
      {
        id: 6,
        title: "Underwater Kingdom",
        description: "Dive deep into the ocean and meet mermaids, talking fish, and discover hidden treasures in this aquatic tale.",
        price: 17.99,
        image: "https://images.unsplash.com/photo-1476275466078-4007374efbbe?w=400&h=500&fit=crop"
      }
    ];

    // Cart Management
    let cart = [];

    // Load cart from localStorage
    function loadCart() {
      const savedCart = localStorage.getItem('storybookCart');
      if (savedCart) {
        cart = JSON.parse(savedCart);
        updateCartCount();
      }
    }

    // Save cart to localStorage
    function saveCart() {
      localStorage.setItem('storybookCart', JSON.stringify(cart));
      updateCartCount();
    }

    // Update cart count badge
    function updateCartCount() {
      const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
      document.getElementById('cartCount').textContent = totalItems;
    }

    // Load products
    function loadProducts() {
      const grid = document.getElementById('productsGrid');
      grid.innerHTML = products.map(product => `
        <div class="product-card">
          <img src="${product.image}" alt="${product.title}" class="product-image">
          <div class="product-info">
            <h3 class="product-title">${product.title}</h3>
            <p class="product-description">${product.description}</p>
            <div class="product-footer">
              <span class="product-price">$${product.price.toFixed(2)}</span>
              <button class="add-to-cart-btn" onclick="addToCart(${product.id})">
                Add to Cart
              </button>
            </div>
          </div>
        </div>
      `).join('');
    }

    // Add to cart
    function addToCart(productId) {
      const product = products.find(p => p.id === productId);
      const existingItem = cart.find(item => item.id === productId);

      if (existingItem) {
        existingItem.quantity++;
      } else {
        cart.push({
          id: product.id,
          title: product.title,
          price: product.price,
          image: product.image,
          quantity: 1
        });
      }

      saveCart();
      
      // Visual feedback
      const btn = event.target;
      const originalText = btn.textContent;
      btn.textContent = 'âœ“ Added!';
      btn.style.background = 'var(--success)';
      
      setTimeout(() => {
        btn.textContent = originalText;
        btn.style.background = '';
      }, 1000);
    }

    // Open cart modal
    function openCart() {
      document.getElementById('cartModal').classList.add('active');
      renderCart();
    }

    // Close cart modal
    function closeCart() {
      document.getElementById('cartModal').classList.remove('active');
    }

    // Render cart items
    function renderCart() {
      const cartItemsContainer = document.getElementById('cartItems');
      const cartSummary = document.getElementById('cartSummary');

      if (cart.length === 0) {
        cartItemsContainer.innerHTML = `
          <div class="empty-cart">
            <div class="empty-cart-icon">ðŸ›’</div>
            <h3>Your cart is empty</h3>
            <p>Add some magical storybooks to get started!</p>
          </div>
        `;
        cartSummary.style.display = 'none';
        return;
      }

      cartItemsContainer.innerHTML = cart.map(item => `
        <div class="cart-item">
          <img src="${item.image}" alt="${item.title}" class="cart-item-image">
          <div class="cart-item-details">
            <div class="cart-item-title">${item.title}</div>
            <div class="cart-item-price">$${item.price.toFixed(2)} each</div>
            <div class="quantity-controls">
              <button class="qty-btn" onclick="updateQuantity(${item.id}, -1)">âˆ’</button>
              <span class="qty-display">${item.quantity}</span>
              <button class="qty-btn" onclick="updateQuantity(${item.id}, 1)">+</button>
              <button class="remove-btn" onclick="removeFromCart(${item.id})">Remove</button>
            </div>
          </div>
        </div>
      `).join('');

      // Calculate and display total
      const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      document.getElementById('cartTotal').textContent = `$${total.toFixed(2)}`;
      cartSummary.style.display = 'block';
    }

    // Update quantity
    function updateQuantity(productId, change) {
      const item = cart.find(i => i.id === productId);
      if (item) {
        item.quantity += change;
        if (item.quantity <= 0) {
          removeFromCart(productId);
        } else {
          saveCart();
          renderCart();
        }
      }
    }

    // Remove from cart
    function removeFromCart(productId) {
      cart = cart.filter(item => item.id !== productId);
      saveCart();
      renderCart();
    }

    // Checkout with Flutterwave
    function checkout() {
      if (cart.length === 0) return;

      const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      
      // Get customer info (you can add a form for this)
      const customerEmail = prompt("Please enter your email address:");
      if (!customerEmail) return;

      const customerName = prompt("Please enter your full name:");
      if (!customerName) return;

      const customerPhone = prompt("Please enter your phone number:");
      if (!customerPhone) return;

      // Prepare order data
      const orderData = {
        items: cart,
        total: total,
        customer: {
          email: customerEmail,
          name: customerName,
          phone: customerPhone
        },
        timestamp: new Date().toISOString()
      };

      // Initialize Flutterwave
      FlutterwaveCheckout({
        public_key: FLUTTERWAVE_PUBLIC_KEY,
        tx_ref: "STORYBOOK_" + Date.now(),
        amount: total,
        currency: "USD",
        payment_options: "card,mobilemoney,ussd",
        customer: {
          email: customerEmail,
          name: customerName,
          phone_number: customerPhone
        },
        meta: {
          order_items: JSON.stringify(cart.map(item => ({
            title: item.title,
            quantity: item.quantity,
            price: item.price
          })))
        },
        customizations: {
          title: "Storybook Haven",
          description: "Purchase of Children's Storybooks",
          logo: "https://images.unsplash.com/photo-1544947950-fa07a98d237f?w=100&h=100&fit=crop"
        },
        callback: function(data) {
          console.log("Payment successful:", data);
          
          // Save order to Google Sheets via Apps Script
          saveOrder(orderData, data.transaction_id);
          
          // Clear cart
          cart = [];
          saveCart();
          
          // Show success message
          alert("Thank you for your purchase! Your order has been confirmed.");
          closeCart();
          
          // Redirect to success page (optional)
          // window.location.href = "/success.html";
        },
        onclose: function() {
          console.log("Payment modal closed");
        }
      });
    }

    // Save order to Google Apps Script
    function saveOrder(orderData, transactionId) {
      fetch(API_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          action: 'saveOrder',
          order: orderData,
          transactionId: transactionId
        })
      })
      .then(() => {
        console.log('Order saved successfully');
      })
      .catch(error => {
        console.error('Error saving order:', error);
      });
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
      const modal = document.getElementById('cartModal');
      if (event.target === modal) {
        closeCart();
      }
    }

    // Initialize
    window.onload = function() {
      loadCart();
      loadProducts();
    }
  </script>
</body>
</html>
